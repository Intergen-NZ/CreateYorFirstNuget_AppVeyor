version: 1.0.{build}
configuration: Release
platform: Any CPU

environment:
  Private_Nuget_Server_Repo_URL:
    secure: xxxxxx
  Private_Nuget_Server_URL:
    secure: xxxxxx
  Private_Nuget_API_Key:
    secure: xxxxxx

before_build:
- ps: >-
    nuget update -Self

    nuget restore -source "$env:Private_Nuget_Server_Repo_URL;https://www.nuget.org/api/v2" -Verbosity detailed

build:
  project: TestNuget3.sln
  verbosity: normal

after_build:
- ps: >-
    [string](Get-Content *\*\AssemblyInfo.cs) -match 'AssemblyVersion\(\"([0-9]+.[0-9]+.)[0-9]+.[0-9]+\"\)'

    $version = $matches[1]

    $nuspecFile = (Get-ChildItem *.nuspec).Name

    (Get-Content $nuspecFile) | Foreach-Object {$_ -replace "(<version>).*(<\/version>)", "`${1}$version$env:APPVEYOR_BUILD_NUMBER.0`${2}" } | Set-Content $nuspecFile

    nuget pack $nuspecFile

artifacts:
- path: '*.nupkg'
  name: Package
  
deploy_script:
- ps: nuget push *.nupkg -s $env:Private_Nuget_Server_URL $env:Private_Nuget_API_Key